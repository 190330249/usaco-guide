---
id: noisg-19-feast
source: NOI
title: 2019 - Feast
author: Dong Liu
---

**Time Complexity:** $\mathcal{O}(N\log{\sum a[i]})$.

<LanguageSection>

<CPPSection>

```cpp
#include <bits/stdc++.h>
using namespace std;

#define N	300000
#define INF	((long long) 300000 * 1000000000)

int n, k, a[N + 1];
pair<long double, int> dp[N + 1][2];

int main() {
	scanf("%d%d", &n, &k);
	for (int i = 1; i <= n; ++i)
		scanf("%d", a + i);
	auto check = [&](long double penalty) {
		dp[0][0] = {0, 0}, dp[0][1] = {-INF, 0};
		for (int i = 1; i <= n; ++i) {
			dp[i][0] = max(dp[i - 1][0], dp[i - 1][1]);
			dp[i][1] = max(make_pair(dp[i - 1][1].first + a[i], dp[i - 1][1].second),
				make_pair(dp[i - 1][0].first + a[i] - penalty, dp[i - 1][0].second + 1));
		}
		return max(dp[n][0], dp[n][1]).second >= k;
	};
	long double lower = 0, upper = INF;
	for (int it = 0; it < 100; ++it) {
		long double mid = (lower + upper) / 2;
		if (check(mid)) {
			lower = mid;
		} else {
			upper = mid;
		}
	}
	long double penalty = lower;
	check(penalty);
	printf("%lld\n", (long long) round(penalty * k + max(dp[n][0], dp[n][1]).first));
}
```

</CPPSection>

</LanguageSection>
